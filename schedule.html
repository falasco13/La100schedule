<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schedule Builder ¬∑ LA 100</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
:root{
  --navy:#1B1F6E;--mid:#2D3396;--accent:#4F5EFF;--accent-lt:#EEF0FF;
  --gold:#F5C842;--off:#F4F5FF;--text:#0D0E2E;--muted:#7478A8;
  --border:#E2E4F6;--green:#0B6B48;--red:#C8102E;--card:#fff;
  --c-promo-bg:#EEF0FF;--c-promo-bd:#C4CBFF;--c-promo-tx:#1B1F6E;
  --c-exito-bg:#E6F7EE;--c-exito-bd:#A8D5B8;--c-exito-tx:#0B5E38;
  --c-sep-bg:#FFF8E1;--c-sep-bd:#FFD97D;--c-sep-tx:#7A5800;
  --c-oclk-bg:#F5F5F5;--c-oclk-bd:#DDD;--c-oclk-tx:#555;
}
body{font-family:'Sora',sans-serif;background:var(--off);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}

/* NAV */
nav{background:var(--navy);height:54px;padding:0 18px;display:flex;align-items:center;gap:14px;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(0,0,0,.2);}
.logo{background:var(--gold);color:var(--navy);font-weight:800;font-size:0.85rem;padding:4px 10px;border-radius:6px;text-decoration:none;}
.nav-t{color:#fff;font-weight:600;font-size:0.85rem;}
.nav-r{margin-left:auto;display:flex;gap:10px;align-items:center;}
a.nav-link{color:rgba(255,255,255,.5);font-size:0.73rem;text-decoration:none;transition:color .15s;}
a.nav-link:hover{color:#fff;}

/* APP LAYOUT */
.app{display:flex;height:calc(100vh - 54px);}

/* SIDEBAR */
.sb{width:260px;min-width:260px;background:var(--card);border-right:1.5px solid var(--border);display:flex;flex-direction:column;overflow-y:auto;}
.sbs{padding:13px 15px;border-bottom:1px solid var(--border);}
.sbs-lbl{font-size:0.59rem;font-weight:700;letter-spacing:1.3px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;}

/* URL INPUT */
.url-in{width:100%;padding:7px 9px;border:1.5px solid var(--border);border-radius:7px;font-size:0.72rem;font-family:'Sora',sans-serif;outline:none;color:var(--text);background:#FAFBFF;transition:border .15s;}
.url-in:focus{border-color:var(--accent);}
.status-chip{margin-top:6px;padding:5px 9px;border-radius:6px;font-size:0.68rem;display:none;line-height:1.4;}
.sch-ok{background:#E6F7EE;color:#0B5E38;}
.sch-err{background:#FDEAED;color:#8B0F24;}
.sch-load{background:#FFF8E1;color:#7A5800;}

/* IMPORT DROP */
.drop-zone{border:2px dashed var(--border);border-radius:9px;padding:14px 12px;text-align:center;cursor:pointer;transition:all .15s;background:#FAFBFF;}
.drop-zone:hover,.drop-zone.drag{border-color:var(--accent);background:var(--accent-lt);}
.drop-zone input{display:none;}
.dz-icon{font-size:1.6rem;margin-bottom:4px;}
.dz-text{font-size:0.71rem;color:var(--muted);line-height:1.5;}
.dz-ok{background:#E6F7EE;border:1px solid #A8D5B8;border-radius:7px;padding:7px 9px;font-size:0.71rem;color:#0B5E38;margin-top:7px;}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:4px;padding:7px 13px;border-radius:8px;border:none;cursor:pointer;font-size:0.74rem;font-weight:700;font-family:'Sora',sans-serif;transition:all .15s;text-decoration:none;}
.btn-navy{background:var(--navy);color:#fff;}.btn-navy:hover{background:var(--accent);}
.btn-green{background:var(--green);color:#fff;}.btn-green:hover{background:#085c3e;}
.btn-ghost{background:var(--off);color:var(--navy);border:1.5px solid var(--border);}.btn-ghost:hover{border-color:var(--accent);color:var(--accent);}
.btn-sm{padding:4px 9px;font-size:0.69rem;}
.btn-full{width:100%;margin-top:5px;}
.btn-row{display:flex;gap:5px;margin-top:7px;flex-wrap:wrap;}
.toast{padding:6px 10px;border-radius:7px;font-size:0.7rem;margin-top:6px;display:none;line-height:1.4;}
.t-ok{background:#E6F7EE;color:#0B5E38;display:block;}
.t-warn{background:#FFF8E1;color:#7A5800;display:block;}
.t-err{background:#FDEAED;color:#8B0F24;display:block;}

/* STATS */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
.stat-box{background:var(--off);border:1px solid var(--border);border-radius:8px;padding:8px 10px;text-align:center;}
.stat-n{font-size:1.3rem;font-weight:800;color:var(--navy);line-height:1;font-family:'DM Mono',monospace;}
.stat-n.warn{color:var(--red);}
.stat-l{font-size:0.6rem;text-transform:uppercase;letter-spacing:0.5px;color:var(--muted);margin-top:2px;}

/* MAT PANEL */
.mg{margin-bottom:4px;}
.mg-hdr{display:flex;align-items:center;justify-content:space-between;padding:5px 8px;background:var(--off);border:1px solid var(--border);border-radius:5px;cursor:pointer;font-size:0.7rem;font-weight:700;color:var(--navy);transition:background .12s;}
.mg-hdr:hover{background:var(--accent-lt);}
.mg-body{display:none;margin-top:2px;border:1px solid var(--border);border-radius:5px;overflow:hidden;}
.mg-body.open{display:block;}
.mi{display:flex;align-items:center;gap:6px;padding:4px 8px;border-bottom:1px solid var(--border);font-size:0.65rem;background:#fff;}
.mi:last-child{border-bottom:none;}
.mi-code{color:var(--navy);font-weight:700;font-family:'DM Mono',monospace;font-size:0.62rem;min-width:66px;}
.mi-name{flex:1;color:#444;font-size:0.63rem;}
.mi-dur{color:#bbb;font-family:'DM Mono',monospace;font-size:0.6rem;white-space:nowrap;}

/* MAIN SCHEDULE */
.main{flex:1;overflow-y:auto;}
.main-hdr{background:var(--navy);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;}
.mh-title{color:#fff;font-weight:700;font-size:0.9rem;}
.mh-sub{color:rgba(255,255,255,.45);font-size:0.65rem;margin-top:1px;}
.mh-actions{display:flex;gap:7px;flex-wrap:wrap;}
.schedule-body{padding:16px 20px;}

/* PROGRAM BLOCK */
.prog-block{margin-bottom:18px;}
.pb-title{background:var(--navy);color:#fff;font-weight:700;font-size:0.73rem;text-transform:uppercase;letter-spacing:0.5px;padding:7px 12px;border-radius:8px 8px 0 0;}
table.sched{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-top:none;border-radius:0 0 8px 8px;overflow:hidden;}
table.sched th{background:var(--accent-lt);color:var(--navy);font-size:0.61rem;font-weight:700;text-transform:uppercase;letter-spacing:0.3px;padding:5px 8px;text-align:left;border-bottom:2px solid var(--border);border-right:1px solid var(--border);white-space:nowrap;}
table.sched th:last-child{border-right:none;}
table.sched td{padding:3px 5px;border-bottom:1px solid #EDF0F7;border-right:1px solid #EDF0F7;vertical-align:middle;}
table.sched td:last-child{border-right:none;}
table.sched tr:last-child td{border-bottom:none;}
td.hour-cell{background:var(--accent-lt);color:var(--navy);font-weight:700;font-size:0.71rem;text-align:center;font-family:'DM Mono',monospace;min-width:44px;white-space:nowrap;}

/* CHIPS IN TABLE */
.chip{display:flex;align-items:center;gap:5px;padding:4px 8px;border-radius:6px;border:1.5px solid transparent;cursor:pointer;position:relative;font-size:0.68rem;transition:filter .12s;}
.chip:hover{filter:brightness(.94);}
.chip-code{font-weight:700;font-size:0.63rem;white-space:nowrap;font-family:'DM Mono',monospace;min-width:64px;}
.chip-name{flex:1;line-height:1.3;}
.chip-dur{font-size:0.6rem;color:rgba(0,0,0,.4);white-space:nowrap;}
.chip-rm{position:absolute;top:1px;right:2px;background:none;border:none;cursor:pointer;font-size:0.6rem;color:rgba(0,0,0,.2);opacity:0;padding:1px;}
.chip:hover .chip-rm{opacity:1;}.chip-rm:hover{color:var(--red)!important;}
.ch-promo{background:var(--c-promo-bg);border-color:var(--c-promo-bd);}.ch-promo .chip-code{color:var(--c-promo-tx);}
.ch-exito{background:var(--c-exito-bg);border-color:var(--c-exito-bd);}.ch-exito .chip-code{color:var(--c-exito-tx);}
.ch-sep{background:var(--c-sep-bg);border-color:var(--c-sep-bd);}.ch-sep .chip-code{color:var(--c-sep-tx);}
.ch-oclk{background:var(--c-oclk-bg);border-color:var(--c-oclk-bd);}.ch-oclk .chip-code{color:var(--c-oclk-tx);}
.empty-chip{display:flex;align-items:center;justify-content:center;height:30px;border:1.5px dashed var(--border);border-radius:6px;color:#ccc;font-size:0.65rem;cursor:pointer;transition:all .12s;}
.empty-chip:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-lt);}
.locked-cell{height:28px;display:flex;align-items:center;padding:0 6px;color:#ddd;font-size:0.63rem;font-style:italic;}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(13,14,46,.5);z-index:500;align-items:center;justify-content:center;backdrop-filter:blur(3px);}
.modal-overlay.open{display:flex;}
.modal{background:#fff;border-radius:14px;width:460px;max-width:95vw;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.2);border:1px solid var(--border);}
.modal-hdr{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;}
.modal-title{font-weight:700;font-size:0.88rem;color:var(--navy);}
.modal-sub{font-size:0.68rem;color:var(--muted);margin-top:2px;}
.modal-close{background:none;border:none;cursor:pointer;color:#aaa;font-size:0.95rem;}.modal-close:hover{color:var(--navy);}
.modal-body{padding:12px 18px;overflow-y:auto;flex:1;}
.modal-search{width:100%;padding:8px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:0.8rem;font-family:'Sora',sans-serif;margin-bottom:10px;outline:none;}
.modal-search:focus{border-color:var(--accent);}
.m-cat-lbl{padding:3px 6px;font-size:0.61rem;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:#aaa;background:var(--off);border-radius:3px;margin:7px 0 3px;}
.m-item{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:6px;cursor:pointer;border:1px solid transparent;transition:background .1s;}
.m-item:hover{background:var(--accent-lt);border-color:var(--border);}
.m-item-code{font-weight:700;font-size:0.64rem;color:var(--navy);min-width:72px;font-family:'DM Mono',monospace;}
.m-item-name{flex:1;font-size:0.75rem;}
.m-item-dur{font-size:0.61rem;color:#bbb;white-space:nowrap;font-family:'DM Mono',monospace;}

/* EMPTY STATE */
.sched-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:400px;text-align:center;padding:40px;}
.se-icon{font-size:3rem;margin-bottom:14px;opacity:.5;}
.se-title{font-size:0.95rem;font-weight:700;color:var(--navy);margin-bottom:7px;}
.se-text{font-size:0.78rem;color:var(--muted);line-height:1.8;max-width:340px;}
.se-steps{margin-top:16px;display:inline-flex;flex-direction:column;gap:5px;text-align:left;}
.se-step{font-size:0.77rem;color:#444;display:flex;align-items:center;gap:8px;}

@media(max-width:700px){
  .app{flex-direction:column;height:auto;}
  .sb{width:100%;min-width:0;border-right:none;border-bottom:1.5px solid var(--border);}
}
</style>
</head>
<body>

<nav>
  <a href="index.html" class="logo">LA 100</a>
  <span class="nav-t">Schedule Builder</span>
  <div class="nav-r">
    <a href="coordinador.html" class="nav-link">‚Üê Coordinador</a>
  </div>
</nav>

<div class="app">

  <!-- SIDEBAR -->
  <div class="sb">

    <div class="sbs">
      <div class="sbs-lbl">üìä Google Sheet (materiales)</div>
      <input class="url-in" id="url-in" placeholder="URL del Sheet publicado como CSV‚Ä¶" oninput="saveUrl()">
      <div class="btn-row">
        <button class="btn btn-navy btn-sm" onclick="recargarSheet()">‚úì Conectar</button>
        <button class="btn btn-ghost btn-sm" onclick="recargarSheet()">üîÑ</button>
      </div>
      <div id="sheet-chip" class="status-chip"></div>
    </div>

    <div class="sbs">
      <div class="sbs-lbl">üì• Asignaciones del coordinador</div>
      <div class="drop-zone" id="drop-zone" onclick="document.getElementById('file-in').click()">
        <div class="dz-icon">üìÇ</div>
        <div class="dz-text">Arrastr√° el archivo <strong>.json</strong><br>o hac√© click para abrirlo</div>
        <input type="file" id="file-in" accept=".json">
      </div>
      <div id="import-ok" style="display:none;" class="dz-ok"></div>
    </div>

    <div class="sbs">
      <div class="sbs-lbl">üé≤ Auto-asignar</div>
      <p style="font-size:0.68rem;color:var(--muted);margin-bottom:7px;line-height:1.5;">Rellena slots vac√≠os al azar, sin repetir en el d√≠a.</p>
      <div class="btn-row">
        <button class="btn btn-ghost btn-sm" onclick="autoAsignar('sep')">üåÖ Sep. Compa√±√≠a</button>
        <button class="btn btn-ghost btn-sm" onclick="autoAsignar('exito')">üéµ √âxito</button>
        <button class="btn btn-navy btn-sm btn-full" onclick="autoAsignar('ambos')">‚ú® Ambos</button>
      </div>
    </div>

    <div class="sbs">
      <div class="sbs-lbl">üìä Estad√≠sticas</div>
      <div class="stats-grid">
        <div class="stat-box"><div class="stat-n" id="s-p">‚Äî</div><div class="stat-l">Promos</div></div>
        <div class="stat-box"><div class="stat-n" id="s-e">‚Äî</div><div class="stat-l">√âxito</div></div>
        <div class="stat-box"><div class="stat-n" id="s-s">‚Äî</div><div class="stat-l">Sep. Compa√±√≠a</div></div>
        <div class="stat-box"><div class="stat-n warn" id="s-v">‚Äî</div><div class="stat-l">Vac√≠os</div></div>
      </div>
      <div id="alerts"></div>
    </div>

    <div class="sbs">
      <div class="sbs-lbl">üì§ Exportar</div>
      <button class="btn btn-ghost btn-sm" onclick="validar()" style="margin-bottom:6px;width:100%;">üîé Validar duplicados</button>
      <button class="btn btn-green btn-full" onclick="exportarExcel()">‚¨á Exportar Excel con colores</button>
<button id="btn-stats" class="btn btn-full" style="background:#F4F5FF; color:#1B1F6E; border:1.5px solid #1B1F6E; margin-top:10px;">üìä Ver Estad√≠sticas Hist√≥ricas</button>
    </div>

    <div class="sbs" style="flex:1;">
      <div class="sbs-lbl">üìã Materiales en rotaci√≥n</div>
      <div id="mat-panel"><div style="font-size:0.71rem;color:var(--muted);">Conect√° el Sheet para ver los materiales.</div></div>
    </div>

  </div>

  <!-- SCHEDULE -->
  <div class="main">
    <div class="main-hdr">
      <div><div class="mh-title" id="main-title">Schedule LA 100</div><div class="mh-sub" id="main-sub">Import√° las asignaciones del coordinador para comenzar</div></div>
      <div class="mh-actions">
        <button class="btn btn-ghost btn-sm" style="color:#fff;border-color:rgba(255,255,255,.3);" onclick="validar()">üîé Validar</button>
        <button class="btn btn-green btn-sm" onclick="exportarExcel()">‚¨á Excel</button>
      </div>
    </div>
    <div class="schedule-body" id="schedule-body">
      <div class="sched-empty">
        <div class="se-icon">üìÇ</div>
        <div class="se-title">CARGAR SCHEDULE</div>
      </div>
    </div>
  </div>

</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-hdr">
      <div><div class="modal-title" id="modal-title">Seleccionar material</div><div class="modal-sub" id="modal-sub"></div></div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <input class="modal-search" id="modal-search" placeholder="Buscar por nombre o c√≥digo‚Ä¶">
      <div id="modal-list"></div>
    </div>
  </div>
</div>

<div id="stats-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; padding:20px; overflow-y:auto; align-items:flex-start; justify-content:center;">
  <div style="background:#fff; width:100%; max-width:900px; margin:40px auto; padding:30px; border-radius:12px; position:relative; font-family:'Sora',sans-serif; box-shadow:0 10px 40px rgba(0,0,0,.3);">
    <button onclick="document.getElementById('stats-modal').style.display='none'" style="position:absolute; top:15px; right:20px; font-size:24px; background:none; border:none; cursor:pointer; color:#7478A8;">&times;</button>
    <h2 style="margin-bottom:20px; color:#1B1F6E;">üìä Reportes de Art√≠stica</h2>

    <div id="stats-loading" style="text-align:center; padding:40px; color:#7478A8; font-weight:600;">Conectando con la base de datos... ‚è≥</div>

    <div id="stats-content" style="display:none;">
      <div style="display:flex; gap:15px; background:#F4F5FF; padding:15px; border-radius:8px; border:1px solid #E2E4F6; margin-bottom:20px; align-items:flex-end; flex-wrap:wrap;">
        <div>
          <label style="display:block; font-size:12px; color:#7478A8; margin-bottom:5px; font-weight:600;">Desde (Fecha de aire):</label>
          <input type="date" id="stat-desde" style="padding:8px; border:1px solid #C4CBFF; border-radius:6px; font-family:'Sora',sans-serif; color:#1B1F6E;">
        </div>
        <div>
          <label style="display:block; font-size:12px; color:#7478A8; margin-bottom:5px; font-weight:600;">Hasta (Fecha de aire):</label>
          <input type="date" id="stat-hasta" style="padding:8px; border:1px solid #C4CBFF; border-radius:6px; font-family:'Sora',sans-serif; color:#1B1F6E;">
        </div>
        <button id="btn-aplicar-filtros" style="padding:9px 20px; background:#1B1F6E; color:#fff; border:none; border-radius:6px; cursor:pointer; font-family:'Sora',sans-serif; font-weight:600;">Filtrar Fechas</button>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
        <div style="border:1px solid #E2E4F6; padding:20px; border-radius:8px;">
           <h3 style="font-size:14px; color:#7478A8; margin-bottom:15px; text-transform:uppercase; letter-spacing:0.5px;">üîç Rendimiento de Material</h3>
           <label style="display:block; font-size:12px; color:#1B1F6E; margin-bottom:5px; font-weight:600;">Eleg√≠ una Promo (agrupa todas sus versiones):</label>
           <select id="stat-material" style="width:100%; padding:10px; border:1px solid #C4CBFF; border-radius:6px; font-family:'Sora',sans-serif; margin-bottom:15px; outline:none; color:#1B1F6E; font-weight:600;">
             <option value="">-- Seleccionar material --</option>
           </select>
           <div id="res-material" style="background:#EEF0FF; padding:20px; border-radius:8px; text-align:center; display:none;">
             <div style="font-size:42px; font-weight:800; color:#1B1F6E; line-height:1;" id="res-count">0</div>
             <div style="font-size:14px; color:#7478A8; margin-bottom:10px;">veces al aire en total</div>
             <div style="font-size:13px; color:#4F5EFF; font-weight:700; background:#fff; display:inline-block; padding:5px 10px; border-radius:4px;" id="res-time">‚è±Ô∏è Tiempo total: 0 min</div>
           </div>
        </div>

        <div style="border:1px solid #E2E4F6; padding:20px; border-radius:8px; display:flex; flex-direction:column;">
           <h3 style="font-size:14px; color:#7478A8; margin-bottom:15px; text-transform:uppercase; letter-spacing:0.5px;">‚è±Ô∏è Minutos por D√≠a</h3>
           <div style="position: relative; height: 250px; width: 100%;">
             <canvas id="chartTiempos"></canvas>
           </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
const DEFAULT_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vS8tViHsYkBBsf5EzW322dc1MAiWMMFdQzuLxym_6x6_ZQrbxv6lpU3DQdMb_s729dKRh2yIiT3RFmb/pub?gid=0&single=true&output=csv';

const PROG_LAV=[
  {name:'LA HORA DE LOS LENTOS',horas:[{h:0,t1i:'promo',t1c:null,t2i:null,t2c:null},{h:1,t1i:null,t1c:'exito',t2i:null,t2c:null}]},
  {name:'TRASNOCHE 100',horas:[{h:2,t1i:'promo',t1c:null,t2i:null,t2c:null},{h:3,t1i:null,t1c:null,t2i:null,t2c:'exito'},{h:4,t1i:'promo',t1c:null,t2i:null,t2c:'exito'},{h:5,t1i:null,t1c:null,t2i:null,t2c:'exito'}]},
  {name:'EL CLUB DEL MORO',horas:[{h:6,t1i:'oclock',t1c:null,t2i:null,t2c:null},{h:7,t1i:'promo',t1c:'exito',t2i:null,t2c:null},{h:8,t1i:'promo',t1c:'exito',t2i:'sep',t2c:null},{h:9,t1i:'promo',t1c:null,t2i:null,t2c:null}]},
  {name:'NO EST√Å TODO DICHO',horas:[{h:10,t1i:'promo',t1c:null,t2i:'sep',t2c:null},{h:11,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'},{h:12,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'},{h:13,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'}]},
  {name:'SARASA',horas:[{h:14,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'},{h:15,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'},{h:16,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'}]},
  {name:'ATARDECER DE UN D√çA AGITADO',horas:[{h:17,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'},{h:18,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'},{h:19,t1i:'promo',t1c:null,t2i:'sep',t2c:'exito'}]},
  {name:'ROM√ÅNTICOS',horas:[{h:20,t1i:'promo',t1c:null,t2i:null,t2c:null},{h:21,t1i:'sep',t1c:'exito',t2i:'sep',t2c:null},{h:22,t1i:'promo',t1c:'exito',t2i:null,t2c:null},{h:23,t1i:null,t1c:null,t2i:null,t2c:null}]}
];
const PROG_SABADO=[
  {name:'TRASNOCHE 100', horas:[{h:2, t1i:'promo', t1c:null, t2i:null, t2c:null}, {h:3, t1i:'promo', t1c:null, t2i:null, t2c:null}]},
  {name:'MUSICAL S√ÅBADO', horas:[{h:6, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:7, t1i:'promo', t1c:null, t2i:null, t2c:null}, {h:8, t1i:'promo', t1c:null, t2i:null, t2c:null}]},
  {name:'TODO QUEDA EN CASA', horas:[{h:9, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:10, t1i:'promo', t1c:null, t2i:'sep', t2c:null}, {h:11, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:12, t1i:'promo', t1c:null, t2i:'promo', t2c:null}]},
  {name:'LA TARDE DE LA 100', horas:[{h:13, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:14, t1i:'promo', t1c:null, t2i:'sep', t2c:null}, {h:15, t1i:'promo', t1c:null, t2i:null, t2c:null}, {h:16, t1i:'promo', t1c:null, t2i:'promo', t2c:'exito'}, {h:17, t1i:'promo', t1c:null, t2i:'sep', t2c:null}]},
  {name:'DISCO RETRO', horas:[{h:18, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:19, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:20, t1i:'promo', t1c:'exito', t2i:null, t2c:null}]}
];
const PROG_DOMINGO=[
  {name:'TRASNOCHE 100', horas:[{h:3, t1i:'promo', t1c:null, t2i:null, t2c:null}, {h:5, t1i:'promo', t1c:null, t2i:null, t2c:null}]},
  {name:'TU M√öSICA TU HISTORIA', horas:[{h:7, t1i:'promo', t1c:null, t2i:'sep', t2c:null}, {h:8, t1i:'promo', t1c:'exito', t2i:'sep', t2c:null}, {h:9, t1i:'promo', t1c:null, t2i:'sep', t2c:null}]},
  {name:'ABIERTO LOS DOMINGOS', horas:[{h:10, t1i:'promo', t1c:null, t2i:'sep', t2c:null}, {h:11, t1i:'promo', t1c:'exito', t2i:'sep', t2c:null}, {h:12, t1i:'promo', t1c:null, t2i:'sep', t2c:'exito'}, {h:13, t1i:'promo', t1c:null, t2i:'sep', t2c:null}]},
  {name:'MUSIC WEEKEND', horas:[{h:14, t1i:'promo', t1c:null, t2i:'sep', t2c:null}, {h:15, t1i:'promo', t1c:'exito', t2i:'sep', t2c:null}, {h:16, t1i:'promo', t1c:null, t2i:'sep', t2c:null}, {h:17, t1i:'promo', t1c:'exito', t2i:'sep', t2c:null}]},
  {name:'DISCO RETRO', horas:[{h:18, t1i:'promo', t1c:'exito', t2i:null, t2c:null}, {h:19, t1i:'sep', t1c:'exito', t2i:null, t2c:null}, {h:20, t1i:'promo', t1c:'exito', t2i:null, t2c:null}]}
];
const ESTRUCTURAS = { 1:PROG_LAV, 2:PROG_LAV, 3:PROG_LAV, 4:PROG_LAV, 5:PROG_LAV, 6:PROG_SABADO, 0:PROG_DOMINGO };
let PROGS = PROG_LAV;
const OCLOCK={c:'C2212328',n:'OCLOCK LA 100 GENERICO 2023 DIA VERANO',d:17};

let MAT={shows:[],mini_lolla:[],concursos:[],sep_comp:[],exito_vista:[]};
let SCH={};
let inited=false, importFecha='';

function initSCH(){
  SCH={}; for(let h=0;h<24;h++) SCH[h]={t1i:null,t1c:null,t2i:null,t2c:null};
  inited=true;
}

async function recargarSheet(){
  const url=document.getElementById('url-in').value;
  const res=await fetch(url);
  const text=await res.text();
  // parseo simplificado para el ejemplo
  renderMatPanel();
}

function importJSON(file){
  const reader=new FileReader();
  reader.onload=e=>{
    const data=JSON.parse(e.target.result);
    importFecha = data.fecha;
    const d = new Date(importFecha + "T12:00:00Z");
    PROGS = ESTRUCTURAS[d.getUTCDay()] || PROG_LAV;
    initSCH();
    data.asignaciones.forEach(a=>{
      SCH[a.hora][a.slot] = {c:a.code, n:a.name, d:a.dur};
    });
    renderSchedule();
  };
  reader.readAsText(file);
}

// ... Resto de funciones (renderSchedule, exportar, etc) ...
// (Asegurate de mantener tus funciones de exportarExcel y validar tal cual las ten√≠as)
</script>
</body>
</html>
